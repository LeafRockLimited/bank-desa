import{_ as B}from"./AdminLayout-D7x4X-Vj.js";import{r as l,o as d,c as S,w as h,a as e,n as f,Z as T,i as A,T as V,b as j,d as c,e as u,F,t as o,f as p,g as y,v as x,h as P}from"./app-B2goeVmr.js";import{T as H,C as R}from"./CardBody-CpEReZhc.js";import{P as q}from"./PrimaryButton-ChptpEbZ.js";import{H as k}from"./Helper-BlyvImFi.js";import{N as L}from"./NasabahSelect-CZ6pjLDT.js";import{_ as w}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-BUQp7NpC.js";import"./ResponsiveNavLink-BwJSSKKb.js";import"./SecondaryButton-NRDCaHm7.js";const D={props:{nasabah_id:{type:Number,required:!0},dataComplete:{type:Boolean,default:!1}},data(){return{selectedPinjaman:null,pinjamans:{}}},beforeMount(){this.getPinjaman()},computed:{dataPinjaman(){var t,a;return(a=(t=this.pinjamans)==null?void 0:t.data)==null?void 0:a.map(i=>({code:i.id,label:`Pengajuan ${i.tanggal_pengajuan}, Nominal ${k.rupiah(i.jumlah_pinjaman)} (${i.status_pinjaman})`}))},hasNextPage(){return this.pinjamans.next_page_url!=null},hasPrevPage(){return this.page>1}},watch:{nasabah_id:{handler(t){this.getPinjaman()},immediate:!0},selectedPinjaman(t){var a;if(this.dataComplete){let _=((a=this.pinjamans)==null?void 0:a.data.filter(n=>n.id==t.code))[0];this.$emit("on-change",_)}else this.$emit("on-change",t.code)},page(){this.getPinjaman()},searchQuery(){this.getPinjaman()}},methods:{onSearch(){},async getPinjaman(){if(this.nasabah_id!=null){const t=await axios.get(route("pinjaman.show",{page:this.page,searchQuery:this.searchQuery,nasabah_id:this.nasabah_id}));if(t.status==200){const a=t.data;this.pinjamans=a}}}}},O={class:"flex flex-row space-x-2 justify-center"},Q=["disabled"],U=["disabled"];function I(t,a,i,_,n,s){const g=l("v-select");return d(),S(g,{modelValue:n.selectedPinjaman,"onUpdate:modelValue":a[2]||(a[2]=m=>n.selectedPinjaman=m),options:s.dataPinjaman,filterable:!1,onSearch:s.onSearch},{"list-footer":h(()=>[e("li",O,[e("button",{class:f([{"bg-gray-100 !text-black":s.hasPrevPage==!0},"w-full h-8 text-gray-200"]),onClick:a[0]||(a[0]=m=>t.page-=1),disabled:!s.hasPrevPage},"Prev",10,Q),e("button",{class:f([{"bg-gray-100 !text-black":s.hasNextPage==!0},"w-full h-8 text-gray-200"]),onClick:a[1]||(a[1]=m=>t.page+=1),disabled:!s.hasNextPage},"Next",10,U)])]),_:1},8,["modelValue","options","onSearch"])}const M=w(D,[["render",I]]),z={components:{AuthenticatedLayout:B,Head:T,Link:A,Table:H,CardBody:R,PrimaryButton:q,NasabahSelect:L,PinjamanSelect:M},data(){return{selectedNasabah:null,selectedPinjaman:{bunga:0,created_at:null,id:null,jenis_pinjaman:null,jumlah_pinjaman:0,nasabah:null,nasabah_id:null,nominal_diterima:0,status_pinjaman:null,tanggal_disetujui:null,tanggal_jatuh_tempo:null,tanggal_pengajuan:null,updated_at:null},angsuranTerakhir:{pinjaman_id:null,tanggal_bayar:0,jumlah_bayar:0,bunga:0,sisa_pinjaman:0},form:V({pinjaman_id:null,tanggal_bayar:null,jumlah_bayar:0,bunga:0}),errors:{}}},computed:{nominalBayarFormatted(){return this.formattedRupiah(this.form.jumlah_bayar)}},watch:{form:{handler(t,a){},deep:!0,immediate:!0},selectedPinjaman(){this.getAngsuranTerakhir()}},methods:{async submitForm(){try{await j.post(route("angsuran.store"),this.form),this.$inertia.visit(route("angsuran.index"))}catch(t){t.response&&t.response.status===422&&(this.errors=t.response.data.errors)}},formattedRupiah(t){return Array.isArray(t)&&(t=t.reduce((a,i)=>a+i,0)),k.rupiah(t)},async getAngsuranTerakhir(){try{const a=(await j.get(route("angsuran.angsuran_terakhir",{id:this.form.pinjaman_id}))).data;Object.keys(a).length>0?this.angsuranTerakhir=a:this.angsuranTerakhir={pinjaman_id:null,tanggal_bayar:0,jumlah_bayar:0,bunga:0,sisa_pinjaman:this.selectedPinjaman.jumlah_pinjaman}}catch{}}}},E=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Angsur Pinjaman",-1),J={class:"space-y-4"},Z=e("p",null,"Pilih Nasabah",-1),G=e("p",null,"Pinjaman Nasabah",-1),K={key:0,class:"text-red-600 text-sm"},W=e("label",{for:"tanggal_bayar",class:"block text-sm font-medium text-gray-700"},"Tanggal Bayar",-1),X={key:0,class:"text-red-600 text-sm mt-1"},Y=e("label",{for:"jumlah_bayar",class:"block text-sm font-medium text-gray-700"},"Jumlah Bayar",-1),$={key:0,class:"text-red-600 text-sm mt-1"},aa={class:"block text-sm font-medium text-gray-700 text-end"},ea={class:"w-full self-end py-6 space-y-4"},ta={class:"flex flex-row border-b justify-between text-md font-medium text-gray-700"},na=e("span",null,"Total Pinjaman :",-1),sa={class:"flex flex-row border-b justify-between text-md font-medium text-gray-700"},ra=e("span",null,"Dibayar :",-1),ia={class:"block text-xl font-medium text-gray-700 text-end"},oa={class:"mt-6 flex justify-end"};function la(t,a,i,_,n,s){const g=l("Head"),m=l("NasabahSelect"),v=l("PinjamanSelect"),N=l("CardBody"),C=l("AuthenticatedLayout");return d(),c(F,null,[u(g,{title:"Angsuran"}),u(C,null,{header:h(()=>[E]),default:h(()=>[u(N,null,{content:h(()=>{var b;return[e("div",J,[e("div",null,[Z,u(m,{onOnChange:a[0]||(a[0]=r=>{n.selectedNasabah=r})})]),e("div",null,[G,u(v,{nasabah_id:n.selectedNasabah,onOnChange:a[1]||(a[1]=r=>{n.form.pinjaman_id=r.id,n.selectedPinjaman=r}),dataComplete:!0},null,8,["nasabah_id"]),n.errors.pinjaman_id?(d(),c("span",K,o(n.errors.pinjaman_id),1)):p("",!0)]),e("div",null,[W,y(e("input",{id:"tanggal_bayar","onUpdate:modelValue":a[2]||(a[2]=r=>n.form.tanggal_bayar=r),type:"date",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[x,n.form.tanggal_bayar]]),n.errors.tanggal_bayar?(d(),c("p",X,o(n.errors.tanggal_bayar),1)):p("",!0)]),e("div",null,[Y,y(e("input",{id:"jumlah_bayar","onUpdate:modelValue":a[3]||(a[3]=r=>n.form.jumlah_bayar=r),type:"number",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},null,512),[[x,n.form.jumlah_bayar]]),n.errors.jumlah_bayar?(d(),c("p",$,o(n.errors.jumlah_bayar),1)):p("",!0),e("span",aa,o(s.nominalBayarFormatted),1)]),e("div",ea,[e("div",ta,[na,P(),e("span",null,o(s.formattedRupiah(n.selectedPinjaman.jumlah_pinjaman)),1)]),e("div",sa,[ra,P(),e("span",null,o(s.formattedRupiah(n.form.jumlah_bayar)),1)]),e("span",ia,"Sisa Pinjaman : "+o(s.formattedRupiah(parseInt(((b=n.angsuranTerakhir)==null?void 0:b.sisa_pinjaman)??0)-parseInt(n.form.jumlah_bayar))),1)]),e("div",oa,[e("button",{onClick:a[4]||(a[4]=(...r)=>s.submitForm&&s.submitForm(...r)),class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," Simpan Angsuran ")])])]}),_:1})]),_:1})],64)}const ja=w(z,[["render",la]]);export{ja as default};
